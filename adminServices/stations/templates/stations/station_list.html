{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %} Stations list{% endblock %}
{%block css%}
{%endblock%}
{% block content %}
<div class="d-flex flex-column align-items-center justify-content-center">
<div class="Fields-container">
    <div class="bigger_width_field">
        <label for="fname" class="labels">Search</label>
        <div class="search-box">
            
            <img src="{% static '/images/search-1.png' %}" alt="">
            <input type="text" class="inputs" value="{{prev_search}}" placeholder="E.g. FS324, Halewood" onchange="filterFunction('search',this.value);"><br><br>
        </div>
    </div>

    <div class="small_width_field">
        <label for="cars" class="labels">Brand</label>
        <div class="select-box">
            <select  class="dropdown_input"  onchange="filterFunction('brand',this.value);">
                <option value="All">All</option>
                            {% for i in brands %}
                                {% if prev_brand == i%}
                                    <option value="{{i}}" selected>{{i}}</option>
                                {%else%}
                                    <option value="{{i}}">{{i}}</option>
                                {% endif %}
                            
                            {% endfor %}
            </select>
        </div>
        
    </div>
    <div class="small_width_field">
        <label for="cars" class="labels">Type</label>
        <div class="select-box">
            <select class="dropdown_input" id="" onchange="filterFunction('station_type',this.value);">
                <option value="All">All</option>
                            {% for i in station_types %}
                                    {% if prev_s_type == i%}
                                        <option value="{{i}}" selected>{{i}}</option>
                                    {%else%}
                                        <option value="{{i}}">{{i}}</option>
                                    {% endif %}
                                
                            {% endfor %}

            </select>
        </div>
        
    </div>
    <div class="small_width_field">
        <label for="cars" class="labels">Status</label>
        <div class="select-box">
            <select class="dropdown_input" onchange="filterFunction('status',this.value);">
                <option value="All">All</option>
                {% for i in status_list %}
                    {% if prev_status == i%}
                        <option value="{{i}}" selected>{{i}}</option>
                    {%else%}
                        <option value="{{i}}">{{i}}</option>
                    {% endif %}
                
                {% endfor %}
            </select>
        </div>
        
    </div>
    <div class="extra_small_width_field">
        <button data-toggle="modal" data-target="#bulkupload" class="bulk_upload" onclick="removePreviosResults();">Bulk <img src="{% static '/images/up_arrow.png' %}" class="rotated_button_arrow" alt=""></button>
    </div>
    {% if stations_available %}
        <div class="extra_small_width_field">
            <button class="bulk_upload"><a href="{% url 'station_list' %}?export=Yes{{update_url_param}}" class="export_link" onclick="afterBulkExportRefreshPage();showLoader(null,null)">Bulk <img src="{% static '/images/up_arrow.png' %}" alt=""></a></button>
        </div>
    {% else %}
        
        <div class="extra_small_width_field">
            <button class="bulk_upload" onclick="showDownloadError();">Bulk <img src="{% static '/images/up_arrow.png' %}" alt=""></button>
        </div>
    {% endif %}
    <div class="extra_small_width_field">
        <button class="bulk_upload" onclick="mapAmpecoSiteName();">Ampeco <img src="{% static '/images/up_arrow.png' %}" alt=""></button>
    </div>
    <div class="small_width_field1">
        <a href="{% url 'station_add' %}{{query_params_str}}" class="add_new_site"><img src="{% static '/images/plus-sign.png'%}" alt=""></a>
    </div>


</div>
<div class="table_container">
    <table class="table" aria-describedby="stationtemplate">
        <thead>
          <tr>
            <th scope="col" class="table-heading" onclick="orderByFunction('order_by_station')">
                Station ID  
                {% if prev_station_order == 'Descending' %}
                    
                    <img id="order_by_station" class="order-by" src="{%static 'images/order-img.png'%}" alt="">
                {% else %}
                    
                    <img id="order_by_station"  src="{%static 'images/order-img.png'%}" alt="">
                {% endif %}
            </th>
            <th scope="col" class="table-heading">Name</th>
            <th scope="col" class="table-heading">Address</th>
            <th scope="col" class="table-heading">Brand</th>
            <th scope="col" class="table-heading">Type</th>
            <th scope="col" class="table-heading">Status</th>
            <th scope="col" class="table-heading text_align_style">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for i in stations %}
              <tr>
                <th scope="row" class="sites_table"><a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}{{query_params_str}}">{{i.station_id}}</a></th>
                <td class="sites_table"><a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}{{query_params_str}}">{{i.station_name}}</a></td>
                <td class="sites_table"><a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}{{query_params_str}}">{{i.station_address1}}{% if i.station_address2|length > 0 %}, {% endif %}{{i.station_address2}}{% if i.station_address3|length > 0 %}, {% endif %}{{i.station_address3}}</a></td>
                
                <td class="sites_table"><a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}{{query_params_str}}">{{i.brand}}</a></td>
                <td class="sites_table"><a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}{{query_params_str}}">{{i.station_type}}</a></td>
                
                <td><div class="active_status_box sites_table">{% if i.status == 'Active' or i.status == 'Coming soon' %} <div class="active_status"></div>{%else%} <div class="inactive_status"></div>{% endif %}<a class="view_station_details_link_styl" href="{% url 'view_station' i.id %}">{{i.status}}</a> </td>
                <td class="sites_table_del_btn min-w-5 text_align_style"><button class="delete-station-image-button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onclick="appendDeleteContent('{{i.id}}','{{i.station_id}}', '{{i.station_name}}')";><img class="table_buttons station_list_delete_icon_stly" src="{% static '/images/delete.png' %}" alt=""></button><a href="{% url 'update_station' i.id%}{{query_params_str}}"><img class="table_buttons station_list_edit_icon_stly" src="{% static '/images/pencil-2.png' %}" alt=""></a></td>
              </tr>
          {% endfor %}
          <tr>
            <td colspan="7" class="pagination_bx_background">
                <div class="pagination_div">
                        <div class="record_count">
                            
                            {% if data_count is 0 %}
                                <p class="sites_table">No records</p>
                            {% else %}
                                <p class="sites_table">   <strong>{{first_data_number}}</strong>-<strong>{{last_data_number}}</strong> of <strong>{{data_count}}</strong> records </p>
                            {% endif %}
                        </div>
                        <div class="pagination_buttons d-flex justify-content-lg-start">
                            {% if data_count >= 10 %}
                                {% if prev  %}
                                    <a href="{% url 'station_list' %}?page={{prev}}{{update_url_param}}" ><button class="pagination_button prev" >Previous</button></a>
                                {% else %}
                                    
                                    <button class="disabled_button prev">Previous</button>
                                {% endif %} 
                            {% endif %}
                            {% for i in pagination_num_list%}
                                
                                {% if i is None %}

                                    <span>.</span>

                                {% else %}
                                    {% if current_page == i%}
                                        <a href="#"  ><button class="active_pagination_button">{{i}}</button></a>
                                    {% else %}
                                        <a href="{% url 'station_list' %}?page={{i}}{{update_url_param}}" ><button class="pagination_button">{{i}}</button></a>
                                    {% endif %}
                                {% endif %}   
                            {% endfor %}
                            
                            {% if data_count >= 10 %}
                                {% if next  %}
                                    <a href="{% url 'station_list' %}?page={{next}}{{update_url_param}}" ><button class="pagination_button next">Next</button></a>
                                {% else %}
                                    
                                    <button class="disabled_button next">Next</button>
                                {% endif %}
                            {% endif %}
                        </div>
                </div>  
            
            </td>
          </tr>
        </tbody>
      </table>
</div>
</div>

<div class="modal fade" id="staticBackdrop"   data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered ">
      <div class="modal-content google_maps_content station_list_delete_site_modal_styl">
         
        <div class="modal-body">
            <div class="heading">
                <h5>Delete Site</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        
            </div>
            <div class="station_list_delete_site_modal_styl_content" id="delete-modal-content">

            </div>
            
        </div>
      </div>
    </div>
  </div>



  <div class="modal fade" id="bulkupload" tabindex="-1" role="dialog" aria-hidden="true" >
    <div class="modal-dialog promotion-modal-dialog" role="document" >
      <div class="modal-content modal_padding promotion-modal-content">
        <div class="modal-header border-none-style">
          <h5 class="modal-title" id="bulkuploadTitle">Bulk Upload</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeModalFunction();">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body file_upload">
            <label class="custom_file_upload" for='selectSheet'>Select File </label>
            <input id='selectSheet' onchange="unableUploadButton()" type="file">
            <a id='filename'></a>
        </div>
        
        <div id="bulk_upload_res_sucess" >
        </div>
        <div id="bulk_upload_res_error">

        </div>
        <div id="empty_column_errors" >
        </div>
        <div class="px-2"  id="progress_bar_box">
            <label for="progress_bar">Bulk Upload in Progress: <span id="progess_count">0%</span> completed</label><br>
            <progress id="progress_bar" class="w-100" value="3" max="100">  </progress>
        </div>
        <a href="{% url 'station_list' %}?export_errors=Yes{{update_url_param}}" id="error_export_button"
         class="btn btn-outline-danger my-2" 
         onclick="afterBulkExportRefreshPage();showLoader(null,null)">Export Errors</a>

        <div class="error_csv_container display-none-style" id='errorheader'>
            <div >
                <div class="error_csv_title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#FF3B3B" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                  </svg>
                  <strong id="csverrorcount">0</strong>
                  invalid entries
                  <div  onclick="printError(true)" class="ml-auto">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
                        <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                        <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
                    </svg>
                </div>
                </div>
                <div id='containerlisterror' class="show_error_list">
                    <div id="bulk_upload_error_list">

                    </div>
                </div>
            </div>
        </div>
        
            <div id="upload_message"><a class="req_invalid">Please upload the file with all valid entries</a></div>
        <div class="modal-footer  border-none-style">
            

          <button type="button" class="btn btn-secondary cancel_button_bulk" data-dismiss="modal" onclick="closeModalFunction();">Close</button>
          <button type="button" disabled id='upload' onclick="processCSV()" class="btn btn-primary upload_button_bulk">Upload</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="no_download_box"   data-bs-keyboard="false" tabindex="-1"  aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered ">
      <div class="modal-content google_maps_content no_data_to_export_warning_modal no-records-modal no-records-modal" >
        <div class="modal-body">
            <h3 id="updated_status">No Stations to export!</h3>
        </div>
      </div>
    </div>
  </div>

{% endblock%}


{% block js %}

<script type="text/javascript">
  // This javascript code uses data from django tags
    let url_u= `{{update_url_param|safe}}`;
    let window_radirect_location = "{% url 'station_list'%}";
    var token = '{{csrf_token}}';
    var progress_running_session = "{{bulk_upload_running}}";
    
    document.getElementById('progress_bar').value = parseInt("{{percentage}}");
    document.getElementById('progess_count').innerHTML ="{{percentage}}%";
    var errors_export_ready ="{{errors_export_ready}}";

    var bulk_upload_progress_bar_url = `{% url 'progressBar' %}`;
    var uploadSheet_stations_url = `{% url 'uploadSheet' %}`;
    var map_ampeco_site_titles_url = `{% url 'map_ampeco_site_titles' %}`;

</script>
<script src="{% static '/js/common.js' %}"></script>
<script src="{% static 'js/stations/station-list.js' %}"></script>
<script src="{% static 'js/bulk-upload-common-funcs.js'%}"></script>
{% endblock %}