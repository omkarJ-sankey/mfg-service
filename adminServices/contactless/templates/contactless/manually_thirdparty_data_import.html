{% extends 'dashboard/base.html' %}
{% block title %}Thirdparty Data Import{% endblock %}
{% load static %}
{% block stylesheet %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">    
{% endblock %}
{% block content %}
<div class="container pt-5 ">
    <h3 class="text-center py-2">Thirdparty Data Import Form</h3>
    <div class="d-flex justify-content-center">
        <div class="w-50 border p-5 mb-5">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3 row">
                    <label class="col-sm-2 col-form-label">Date</label>
                    <div class="col-sm-10">
                        <input type="date" class="form-control" name="date" id="datePickerId"
                        onkeydown="return false" onpaste="return false" onfocus="this.max=new Date().toISOString().split('T')[0]" />
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-2 col-form-label">Source</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" name="source" />
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <button type="submit" class="btn btn-primary mb-3">Submit</button>
                </div>
            </form>
            <div class="border border-2 mb-4"></div>
            <div class="d-flex flex-column align-items-center pt-3 pr-3 pl-3">
                <div class="form-group w-100 mb-3">
                    <label for="source-select" class="font-weight-bold">Select Data Source:</label>
                    <select id="source-select" class="form-control">
                        <option value="" disabled selected>Select source</option>
                        {% if sources %}
                            {% for src in sources %}
                                <option value="{{ src.value }}">{{ src.label }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="driivz">Driivz</option>
                            <option value="swarco">Swarco</option>
                            <option value="advam">Advam</option>
                        {% endif %}
                    </select>
                </div>
                <div class="form-group w-100 mb-3">
                    <label for="data-file" class="form-label btn btn-dark w-100 mb-2">Choose File</label>
                    <input type="file" id="data-file" accept=".xlsx,.csv" class="form-control" style="display:none;" onchange="onFileSelected()">
                    <span id="file-name" class="ml-2 text-secondary"></span>
                </div>
                <button class="btn btn-primary mt-2 w-100" id="upload-btn" onclick="sendThirdPartyData()" disabled>Upload Data</button>
            </div>
            <div class="mt-3">
                <p class="text-center text-success mb-1" id="success-field">{{success}}</p>
                <p class="text-center text-danger mb-1" id="error-field">{{error}}</p> 
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
<script type="text/javascript">
    let third_party_data_save_url = "{% url 'get_thirdparty_data'%}";
</script>
<script src="{% static '/js/contactless/contactless.js' %}"></script>
{% endblock %}
